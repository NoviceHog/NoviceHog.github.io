---
layout: single
title:  "유니티 다크소울 따라만들기 ch_9 공격"
categories: 
    - Unity
tag: [Unity, DarkSouls]
published: true

author_profile: true # 옆에뜨는 프로파일

search: true #검색해도 안뜨게함

date: 2023-09-21
last_modified_at: 2023-09-21

---
# 구현 개요
플레이어의 강공격 약공격을 구현한다.

## 구현 원리
무기마다 애니메이션이 다를 것이다. 그렇기에<br>
`무기 별로` 재생할 공격 `애니메이션을 string변수`로 할당해서<br>
공격할 때 무기에 접근하여 무기에 있는 애니메이션 변수를 실행하도록 한다.

# 수정 사항

## 스크립트 수정 이름 변경
애니메이션이 끝나면 자동으로 isInteracting 파라미터를 수정하던 스크립트인 ResetIsInteracting을

다음과 같이 이름과 내용을 수정한다.

ResetIsInteracting -> ResetAnimatorBool

```c#
public class ResetAnimatorBool : StateMachineBehaviour
{
    public string targetBool;
    public bool status;

    override public void OnStateEnter(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        animator.SetBool(targetBool, status);
    }
}
```

<br>






## 애니메이터 수정
새 Layer인 `Override`를 만든 후
이동 애니메이션과 행동 애니메이션을 분리해준다.

Override

![image](https://github.com/novicehog/comments/assets/131991619/ac160acb-93a0-4299-a052-d76656ed9254)
 
<br>

Base Layer
![image](https://github.com/novicehog/comments/assets/131991619/477f8647-3757-4f80-99cc-b12b83588b8a)


그리고 모든 애니메이션에서 제거한 뒤 공통의 상태 empty를 만들고
그 안에 넣어준다.

![image](https://github.com/novicehog/comments/assets/131991619/5f9bd88a-a7f3-4f00-820a-39b56fa937f0)

이렇게 수정됨으로써 각 애니메이션을 탈출할 때 바뀌는 것이 아닌
공통된 empty 상태에 진입하게 되면 관련 파라미터값을 설정해주도록 바뀌었다.



## Weapon Item 스크립트 수정

다음과 같이 수정한다.

```c#
[CreateAssetMenu(menuName = "Items/Weapon Item")]
public class WeaponItem : Item
{
    public GameObject modelPrefab;
    public bool isUnarmed;

    [Header("One Handed Attack Animations")]    // 추가된 부분
    public string OH_Light_Attack_1;
    public string OH_Heavy_Attack_1;
}
```

<br>

## PlayerAttacker 스크립트 추가

무기를 매개변수로 받아 애니메이션을 실행하는 스크립트를 만든다.

```c#
public class PlayerAttacker : MonoBehaviour
{
    AnimatorHandler animatorHandler;

    private void Awake()
    {
        animatorHandler = GetComponentInChildren<AnimatorHandler>();
    }

    public void HandleLightAttack(WeaponItem weapon)
    {
        animatorHandler.PlayTargetAnimation(weapon.OH_Light_Attack_1, true);
    }

    public void HandleHeavyAttack(WeaponItem weapon)
    {
        animatorHandler.PlayTargetAnimation(weapon.OH_Heavy_Attack_1, true);
    }
}

```

<br>

## InputAction 추가
새로운 키를 할당해준다.
RB와 RT키가 생겼다.

![image](https://github.com/novicehog/comments/assets/131991619/ac5e1de4-be64-488a-9d3d-6e54bcd836c5)

<br>

## InputHandler 내용 추가


```c#
public bool rb_Input;
public bool rt_Input;

private void HandleAttackInput(float delta)
{
    inputActions.PlayerActions.RB.performed += i => rb_Input = true;
    inputActions.PlayerActions.RT.performed += i => rt_Input = true;

    if(rb_Input)
    {
        playerAttacker.HandleLightAttack(playerInventory.rightWeapon);
    }

    if (rt_Input)
    {
        playerAttacker.HandleHeavyAttack(playerInventory.rightWeapon);
    }
}
```

## PlayerManager 내용 추가